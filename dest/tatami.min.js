/*!
 * Tatami v0.3.0
 * http://ourai.github.io/tatami/
 *
 * Copyright 2013, 2014 Ourairyu, http://ourai.ws/
 *
 * Date: 2014-07-02
 */

!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("Requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a){"use strict";var b,c,d,e,f,g=[].slice;b={name:"Tatami",version:"0.3.0"},d=function(a){var c,e,f,g,h,i,j,k;return k={}.toString,i={validator:function(){return!0}},j={types:{}},h=function(){var a,b,c,d,e;for(b="Boolean Number String Function Array Date RegExp Object".split(" "),c=function(a){var b;return j.types["[object "+a+"]"]=b=a.toLowerCase(),j.methods["is"+a]=function(a){return this.type(a)===b}},d=0,e=b.length;e>d;d++)a=b[d],c(a);return j.types},g=function(a,b){return null==a?!1:Object.prototype.hasOwnProperty.call(a,b)},f=function(a){var c,d,e;d="__"+b.name.toLowerCase()+"__",e=!0;try{Object.defineProperty(a,d,{__proto__:null,value:e})}catch(f){c=f,a[d]=e}return!0},e=function(a,b,d){var f;return f=j.methods,f.isArray(b)||f.isPlainObject(b)&&!f.isArray(b.handlers)?f.each(b,function(a){return e(null!=a?a.handlers:void 0,a,d)}):f.isPlainObject(b)&&f.isArray(b.handlers)&&f.each(a,function(a){return c(a,b,d)}),d},c=function(a,b,c){var d,e,f,h,k,l,m,n,o;if(h=a.name,f=j.methods,a.expose!==!1&&!f.isFunction(c[h])){for(d=a.handler,m=g(a,"value")?a.value:b.value,l=[a.validator,b.validator,i.validator,function(){return!0}],n=0,o=l.length;o>n&&(k=l[n],!f.isFunction(k));n++);e=function(){return f.isFunction(d)&&k.apply(c,arguments)===!0?d.apply(c,arguments):m},c[h]=e}return c},j.methods={mixin:function(){var a,b,c,d,e,f,g,h;for(a=arguments,d=a.length,g=null!=(h=a[0])?h:{},c=1,1===d&&(g=this,c--);d>c;){if(f=a[c],"object"==typeof f)for(e in f)b=f[e],b!==g&&void 0!==b&&(g[e]=b);c++}return g},each:function(a,b){var c,d,e,f;if(this.isArray(a)||this.isArrayLike(a)||this.isString(a))for(d=0;d<a.length&&(c=this.isString(a)?a.charAt(d):a[d],b.apply(c,[c,d++,a])!==!1););else if(this.isObject(a)||this.isFunction(a))for(e in a)if(f=a[e],b.apply(f,[f,e,a])===!1)break;return a},type:function(a){return null==a?String(a):j.types[k.call(a)]||"object"},slice:function(a,b){return null==a?[]:[].slice.call(a,Number(b)||0)},hasProp:function(b,c){return g.apply(this,[arguments.length<2?a:c,b])},isWindow:function(a){return a&&this.isObject(a)&&"setInterval"in a},isElement:function(a){return a&&this.isObject(a)&&1===a.nodeType},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isInteger:function(a){return this.isNumeric(a)&&/^-?[1-9]\d*$/.test(a)},isPlainObject:function(a){var b,c;if(!a||!this.isObject(a)||a.nodeType||this.isWindow(a))return!1;try{if(a.constructor&&!this.hasProp("constructor",a)&&!this.hasProp("isPrototypeOf",a.constructor.prototype))return!1}catch(d){return b=d,!1}for(c in a);return void 0===c||this.hasProp(c,a)},isEmpty:function(a){var b,c;if(c=!1,null==a||""===a)c=!0;else if((this.isArray(a)||this.isArrayLike(a))&&0===a.length)c=!0;else if(this.isObject(a)){c=!0;for(b in a){c=!1;break}}return c},isArrayLike:function(a){var b,c;return c=!1,this.isObject(a)&&null!==a&&(this.isWindow(a)||(b=a.length,(1===a.nodeType&&b||!this.isArray(a)&&!this.isFunction(a)&&(0===b||this.isNumber(b)&&b>0&&b-1 in a))&&(c=!0))),c}},h(),d=function(a,b){return e(null!=a?a.handlers:void 0,a,null!=b?b:{})},j.methods.each(j.methods,function(a,b){return d[b]=a}),d}(a),f=function(a,b){var c,d,e,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;B={}.toString,h=/^[0-9A-Z_.]+[^_.]?$/i,y={regexps:{date:{iso8601:/^(\d{4})\-(\d{2})\-(\d{2})(?:T(\d{2})\:(\d{2})\:(\d{2})(?:(?:\.)(\d{3}))?(Z|[+-]\d{2}\:\d{2})?)?$/},object:{array:/\[(.*)\]/,number:/(-?[0-9]+)/}},modules:{Core:{}}},y.modules.Core.BuiltIn={handlers:function(){var a;a=[];for(w in b)r=b[w],a.push({name:w,handler:r});return a}()},j=function(a,b,c,d){var e,f,g,h;return h=!1,f=this,g=f.isPlainObject(a),(g||d)&&c?h=b===a:(e=g?j.apply(f,[f.keys(a),f.keys(b),!1,!0]):b.length===a.length,e&&f.each(a,function(a,e){var g;return g=f.type(a),f.inArray(g,["string","number","boolean","null","undefined"])>-1?h=b[e]===a:f.inArray(g,["date","regexp","function"])>-1?h=c?b[e]===a:b[e].toString()===a.toString():f.inArray(g,["array","object"])>-1?h=j.apply(f,[a,b[e],c,d]):void 0})),h},z=function(a){var b,c,d,e;return d=this.isArray(a)?function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.stringify(b));return e}.call(this):function(){var b;b=[];for(c in a)e=a[c],b.push('"'+c+'":'+this.stringify(e));return b}.call(this),d.join(",")},y.modules.Core.Global={handlers:[{name:"extend",handler:function(a,c){return b(a,c)}},{name:"alias",handler:function(b){return this.isString(b)&&void 0===a[b]&&(a[b]=this),a[String(b)]}},{name:"mask",handler:function(b){var c,d,e;if(this.hasProp(b))a.console&&console.error("'"+b+"' has existed as a property of Window object.");else{d=this.__meta__.name,a[b]=a[d];try{e=delete a[d]}catch(f){c=f,a[d]=void 0,e=!0}this.__meta__.name=b}return e},validator:function(a){return this.isString(a)},value:!1},{name:"namespace",handler:function(){var b,c,d,e;return b=arguments,d=this,e={},c=b[0],d.isPlainObject(c)||(c=b[b.length-1]===!0?a:this),d.each(b,function(a){var b;return d.isString(a)&&/^[0-9A-Z_.]+[^_.]$/i.test(a)&&(b=c,d.each(a.split("."),function(a,c,d){return void 0===b[a]&&(b[a]=c===d.length-1?null:{}),b=b[a],!0}),e=b),!0}),e}},{name:"equal",handler:function(a,b,c){var d,e,f,g,h;return g=!1,e=this,h=e.type(a),e.type(b)===h&&(f=e.isPlainObject(a),(f&&e.isPlainObject(b)||"object"!==h)&&(d=e.isArray(a),f||d||(a=[a],b=[b]),e.isBoolean(c)||(c=!1),g=j.apply(e,[a,b,c,d]))),g}},{name:"random",handler:function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))}},{name:"stringify",handler:function(a){var b,c,d;if(d=this.type(a),"object"===d)if(this.isPlainObject(a))try{c=JSON.stringify(a)}catch(e){b=e,c="{"+z.call(this,a)+"}"}else c="";else switch(d){case"array":c="["+z.call(this,a)+"]";break;case"function":case"date":case"regexp":c=a.toString();break;case"string":c='"'+a+'"';break;default:try{c=String(a)}catch(e){b=e,c=""}}return c}},{name:"parse",handler:function(a){var b;return a=this.trim(a),b=a,this.each(y.regexps.object,function(c){return function(d,e){var f,g,h;if(h=new RegExp("^"+d.source+"$"),h.test(a)){switch(e){case"array":for(g=new RegExp(""+d.source,"g"),f=/(\[.*\])/,d=g.exec(a),b=[];null!=d;){c.each(d[1].split(","),function(a){return b.push(c.parse(a))});break}break;case"number":b*=1}return!1}return!0}}(this)),b},validator:function(a){return this.isString(a)},value:"",expose:!1}]},y.modules.Core.Object={handlers:[{name:"keys",handler:function(a,b){var c;return c=[],this.each(a,function(a,d){return a===b?(c=d,!1):c.push(d)}),this.isArray(c)?c.sort():c},validator:function(a){var b;return!(null===a||a instanceof Array||"object"!=(b=typeof a)&&"function"!==b)},value:[]}]},u=function(a){return a instanceof Array},v=function(a){return this.isArray(a)||this.isPlainObject(a)},s=function(a,b,c,d,e){var f,g;if(g={value:a,computed:a},v.call(this,c)){if(f=this.isFunction(d),!f&&this.isArray(c)&&c[0]===+c[0]&&c.length<65535)return Math[b].apply(Math,c);this.each(c,function(a,c,h){var i;return i=f?d.apply(e,[a,c,h]):a,"max"===b&&i>g.computed||"min"===b&&i<g.computed?g={value:a,computed:i}:void 0})}return g.value},o=function(a){var b,c;return c=this,b=[],c.isArray(a)?c.each(a,function(a){return b=b.concat(o.call(c,a))}):b=a,b},p=function(a){var b;return b=/^([-+]?\d+)\.(\d+)$/,(b.test(a)?(a+"").match(b)[2]:"").length},x=function(a,b,c,d){var e;for(e=[];b>=a;)e.push(d?d(a):a),a+=c;return e},n=function(b,c,d,e,f){var g,h,i,j,k;return j=null,h=this,h.isFunction(c)&&(g="array"===(k=h.type(b))||"string"===k,null==d&&(d=a),h.isFunction(e)&&g?j=e.apply(b,[c,d]):(i=h.isPlainObject(b),i?j={}:g&&(j=[]),null!==j&&h.each(b,function(a,e){var k;return k=c.apply(d,[a,e,h.isString(b)?new String(b):b]),f(j,k,a,e,i,g),!0})),h.isString(b)&&(j=j.join(""))),j},y.modules.Core.Array={value:[],validator:function(a){return u(a)},handlers:[{name:"inArray",handler:function(a,b,c){var d,e,f;if(d=-1,e=Array.prototype.indexOf,f=b.length,c=c?0>c?Math.max(0,f+c):c:0,e)d=e.apply(b,[a,c]);else for(;f>c;){if(c in b&&b[c]===a){d=c;break}c++}return d},validator:function(a,b){return u(b)},value:-1},{name:"filter",handler:function(a,b,c){return n.apply(this,[a,b,c,[].filter,function(a,b,c,d,e,f){if(b){if(e)return a[d]=c;if(f)return a.push(c)}}])},validator:function(a){var b;return u(a)||"object"==(b=typeof a)||"string"===b},value:null},{name:"map",handler:function(a,b,c){return n.apply(this,[a,b,c,[].map,function(a,b,c,d){return a[d]=b}])},validator:function(a){var b;return u(a)||"object"==(b=typeof a)||"string"===b},value:null},{name:"product",handler:function(a){var b,c,d;return d=1,b=0,c=this,c.each(a,function(a){return c.isNumeric(a)?(b++,d*=a):void 0}),0===b?0:d},value:null},{name:"unique",handler:function(a,b){var c,d;return d=[],c=this,b=!!b,c.each(b?a.reverse():a,function(a){return c.isNumeric(a)&&(a=parseFloat(a)),-1===c.inArray(a,d)?d.push(a):void 0}),b&&(a.reverse(),d.reverse()),d},value:null},{name:"range",handler:function(a,b,c){var d,e,f,g,h,i,j,k,l;return l=[],i=this,c=i.isNumeric(c)&&1*c>0?1*c:1,i.isNumeric(a)&&i.isNumeric(b)?(f=p(a),h=p(b),g=p(c),e=Math.max(f,h,g),e>0?(e=1*i.zerofill(1,e+1),c*=e,d=function(a){return a/e}):e=1,a*=e,b*=e):(j=/^[a-z]$/,k=/^[A-Z]$/,a+="",b+="",(j.test(a)&&j.test(b)||k.test(a)&&k.test(b))&&(a=a.charCodeAt(0),b=b.charCodeAt(0),d=function(a){return String.fromCharCode(a)})),i.isNumber(a)&&i.isNumber(b)&&(l=a>b?x(b,a,c,d).reverse():b>a?x(a,b,c,d):[d?d(a):a]),l},validator:function(){return!0}},{name:"reduce",handler:function(b,c,d,e){var f,g,h,i,j,k,l;if(j=this,e=!!e,j.isArray(b))if(f=arguments,k=e?[].reduceRight:[].reduce,g=f.length>2,k)l=k.apply(b,g?[c,d]:[c]);else if(h=0,i=b.length,g||(d=b[0],h=1,i--),j.isFunction(c)){for(i=g?i:i+1;i>h;)d=c.apply(a,[d,b[h],h,b]),h++;l=d}return l},value:null},{name:"flatten",handler:function(a){return o.call(this,a)}},{name:"shuffle",handler:function(a){var b,c,d,e;return c=this,e=[],b=0,d=void 0,c.each(a,function(a){return d=c.random(b++),e[b-1]=e[d],e[d]=a,!0}),e},value:null},{name:"sum",handler:function(a){var b;return b=0/0,v.call(this,a)&&(b=0,this.each(a,function(a){return b+=1*a})),b},validator:function(){return!0},value:0/0},{name:"max",handler:function(b,c,d){return s.apply(this,[-1/0,"max",b,c,arguments.length<3?a:d])},validator:function(){return!0}},{name:"min",handler:function(b,c,d){return s.apply(this,[1/0,"min",b,c,arguments.length<3?a:d])},validator:function(){return!0}}]},t=function(a,b,c){var d,e,f;for(e=this,d=e.isRegExp(c)?c:new RegExp(c,"ig"),d.global||(d=new RegExp(d.source,"ig")),f=d.exec(a);f;)f.index<b&&(b+=f[0].length),f.lastIndex=0;return a.substring(0,b)},C=function(a){var b,c,d;return c=this,d=[],c.isString(a)&&(d=function(){var d,e,f;for(f=[],d=0,e=a.length;e>d;d++)b=a[d],f.push("\\u"+c.pad(Number(b.charCodeAt(0)).toString(16),4,"0").toUpperCase());return f}()),d.join("")},D=function(b){var c,d,e;return e=b,d=a.btoa,c=a.atob,this.isString(b)&&this.isFunction(d)&&(e=d(unescape(encodeURIComponent(b)))),e},y.modules.Core.String={value:"",validator:function(a){return this.isString(a)},handlers:[{name:"pad",handler:function(a,b,c){var d,e,f;if((this.isString(c)===!1||1!==c.length)&&(c=" "),this.isInteger(b)||(b=0),a=String(a),d=1,f=String(c),e=Math.abs(b)-a.length,e>0){for(;e>d;)c+=f,d++;a=b>0?a+c:c+a}return a},validator:function(a){var b;return"string"==(b=typeof a)||"number"===b}},{name:"capitalize",handler:function(a,b){var c;return c="[a-z]+",a.replace(b===!0?new RegExp(c,"ig"):new RegExp(c),function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()})}},{name:"camelCase",handler:function(a,b){var c;return a=a.toLowerCase().replace(/[-_\x20]([a-z]|[0-9])/gi,function(a,b){return b.toUpperCase()}),c=a.charAt(0),a=(b===!0?c.toUpperCase():c.toLowerCase())+a.slice(1)}},{name:"zerofill",handler:function(a,b){var c,d,e,f,g;return f="",d=this,g=/^([-+]?\d+)\.(\d+)$/,c=g.test(a),e="",b=parseInt(b),b>0&&c?(a=(a+"").match(g),e=""+1*a[1]+".",a=a[2]):0>1*a&&(e="-",a=(a+"").substring(1)),f=d.pad(a,b,"0"),f=0>b&&c?"":e+f},validator:function(a,b){return this.isNumeric(a)&&this.isNumeric(b)&&/^-?[1-9]\d*$/.test(b)}},{name:"trim",handler:function(a){var b;return b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,r="".trim,r&&!r.call("﻿ ")?r.call(a):a.replace(b,"")}},{name:"substr",handler:function(a,b,c,d){var e,f;return e=arguments,f=this,3===e.length&&f.isNumeric(b)&&b>0&&(f.isString(c)||f.isRegExp(c))?a=t.apply(f,[a,b,c]):f.isNumeric(b)&&b>=0&&((!f.isNumeric(c)||0>=c)&&(c=a.length),a=f.isString(d)||f.isRegExp(d)?t.apply(f,[a.substring(b),c,d]):a.substring(b,c)),a}},{name:"countChars",handler:function(a,b){var c,d,e,f;switch(f=null,e=this,(!e.isInteger(b)||0>b)&&(b=0),c={},d=[],e.each(a,function(a){var b;return b=a.charCodeAt(0),e.isNumber(c[b])?c[b]++:(c[b]=1,e.inArray(a,d)<0?d.push(a):void 0)}),b){case 0:break;case 1:f=c;break;case 2:break;case 3:f=d.join("");break;case 4:}return f},value:null}]},k=function(a){var b,c;return a=this.trim(a),b=new Date(a),isNaN(b.getTime())&&(c=a.match(y.regexps.date.iso8601),b=null!=c?e.call(this,c):new Date),b},e=function(a){var b,c;return a.shift(),b=i.call(this,a),c=A(a.slice(-1)[0]),0!==c&&b.setTime(b.getTime()-c),b},i=function(a){var b,c;return c=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],b=new Date,this.each(a,function(a,d){var e;return null!=a&&""!==a&&(e=c[d],null!=e)?b["setUTC"+e](1*a+("Month"===e?-1:0)):void 0}),b},A=function(a){var b,c;return c=0,/^(Z|[+-]\d{2}\:\d{2})$/.test(a)&&(b=a.charAt(0),"Z"!==b&&(c=a.substring(1).split(":"),c=60*(b+(60*c[0]+1*c[1]))*1e3)),c},d={month:{"long":["January","February","March","April","May","June","July","August","September","October","November","December"],"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},week:{"long":["Sunday","Monday","Tuesday","Wednesday","Thurday","Friday","Saturday"],"short":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},c={d:function(a){return l.call(this,a.getDate())},D:function(a){return d.week.short[a.getDay()]},j:function(a){return a.getDate()},l:function(a){return d.week.long[a.getDay()]},N:function(a){var b;return b=a.getDay(),0===b&&(b=7),b},S:function(a){var b;switch(String(a.getDate()).slice(-1)){case"1":b="st";break;case"2":b="nd";break;case"3":b="rd";break;default:b="th"}return b},w:function(a){return a.getDay()},F:function(a){return d.month.long[a.getMonth()]},m:function(a){return l.call(this,c.n.call(this,a))},M:function(a){return d.month.short[a.getMonth()]},n:function(a){return a.getMonth()+1},Y:function(a){return a.getFullYear()},y:function(a){return String(a.getFullYear()).slice(-2)},a:function(a){var b;return b=a.getHours(),b>0&&12>b?"am":"pm"},A:function(a){return c.a.call(this,a).toUpperCase()},g:function(a){var b;return b=a.getHours(),0===b&&(b=24),b>12?b-12:b},G:function(a){return a.getHours()},h:function(a){return l.call(this,c.g.call(this,a))},H:function(a){return l.call(this,c.G.call(this,a))},i:function(a){return l.call(this,a.getMinutes())},s:function(a){return l.call(this,a.getSeconds())}},l=function(a){return this.pad(a,-2,"0")},q=function(a,b){var d,e;return(!this.isDate(b)||isNaN(b.getTime()))&&(b=new Date),d=this,e=a.replace(new RegExp("([a-z]|\\\\)","gi"),function(){var a,e,f,h,i,j;return e=arguments[0],h=4<=arguments.length?g.call(arguments,1,j=arguments.length-2):(j=1,[]),f=arguments[j++],i=arguments[j++],"\\"===e?"":("\\"!==i.charAt(f-1)&&(a=c[e]),null!=a?a.call(d,b):e)})},y.modules.Core.Date={handlers:[{name:"date",handler:function(a,b){return this.isString(b)&&(b=k.call(this,b)),q.apply(this,[a,b])},value:"",validator:function(a){return this.isString(a)}},{name:"now",handler:function(a){var b;return b=new Date,a===!0?b:b.getTime()}}]},f=b(y.modules);try{Object.defineProperty(f,"__meta__",{__proto__:null,writable:!0,value:{name:"__util",version:""}})}catch(E){m=E,f.mixin({__meta__:{name:"__util",version:""}})}return f}(a,d),c=function(a){var b,d,e,f,g,h;return d=a.hasProp,f=a.isPlainObject,g={},e=function(a){return/^[0-9a-z_.]+[^_.]?$/i.test(a)},h=function(b){var c;return c=g,a.each(b.split("."),function(a){return d(a,c)||(c[a]={}),c=c[a]}),c},b=function(b,c,e){var g,h,i;return a.each(c.split("."),function(a){var c;return c=d(a,b),b=b[a],c}),i=this.settings,f(e)||(e={}),g=f(i.keys)?i.keys:{},h=i.value(b).replace(i.format_regexp,function(){return function(b,c){var f;return f=d(c,e)?e[c]:d(c,g)?g[c]:b,a.isFunction(f)?f():f}}(this))},c=function(){function c(a){this.settings={format_regexp:/.*/g,allow_keys:!1,keys:{},value:function(a){return null!=a?a:""}},this.storage=e(a)?h(""+a):g}return c.prototype.set=function(b){return a.mixin(this.storage,b)},c.prototype.get=function(c,d){var e;return a.isString(c)?e=b.apply(this,[this.storage,c,d]):this.settings.allow_keys===!0&&(e=a.keys(this.storage)),null!=e?e:null},c.prototype.config=function(b){return a.mixin(this.settings,b)},c}()}(f),e=function(a,b){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;return m=1,g=2,t=3,h=4,o=5,n=6,r=7,i=8,k=9,l=10,j=11,q=12,s=/^[0-9A-Z_.]+[^_.]?$/i,d=jQuery,X={lang:document.documentElement.lang||document.documentElement.getAttribute("lang")||navigator.language||navigator.browserLanguage},e=b,U={storage:!!a.localStorage},H={key:{storage:["sandboxStarted","config","fn","buffer","pool","i18n"]}},S={sandboxStarted:!1,config:{debug:!0,platform:"",locale:X.lang,lang:X.lang.split("-")[0]},fn:{prepare:[],ready:[],init:{systemDialog:d.noop,ajaxHandler:function(a,b){return{success:function(c){var f;return f=e.slice(arguments),c.code>0?e.isFunction(a)?a.apply(d,f):void 0:e.isFunction(b)?b.apply(d,f):V("alert",c.message)},error:d.noop}}},handler:{}},modules:{utils:{},flow:{},project:{},storage:{},request:{},HTML:{},URL:{}},buffer:{},pool:{},i18n:{_SYS:{dialog:{zh:{title:"系统提示",close:"关闭",ok:"确定",cancel:"取消",yes:"是",no:"否"},en:{title:"System",close:"Close",ok:"Ok",cancel:"Cancel",yes:"Yes",no:"No"}}}}},F=function(a){return e.slice(a,-1)[0]},R=function(){return d.ajaxSetup({type:"post",dataType:"json"}),d(document).ajaxError(function(a,b){var c;return c=b.responseText,!1})},V=function(b,c,f,g){var h,i,j,k;return k=!1,e.isString(b)&&(b=b.toLowerCase(),e.isFunction(d.fn.dialog)?(j="systemDialog",i=S.i18n._SYS.dialog[e.config("lang")],e.hasProp(j,S.pool)||(S.pool[j]={}),h=S.pool[j][b],h||(h=d('<div data-role="dialog" data-type="system" />').appendTo(d("body")).on({dialogcreate:C("systemDialog"),dialogopen:function(){return d(".ui-dialog-buttonset .ui-button",d(this).closest(".ui-dialog")).each(function(){var a;switch(a=d(this),e.trim(a.text())){case i.ok:b="ok";break;case i.cancel:b="cancel";break;case i.yes:b="yes";break;case i.no:b="no"}return a.addClass("ui-button-"+b)})}}).dialog({title:i.title,width:400,minHeight:100,closeText:i.close,modal:!0,autoOpen:!1,resizable:!1,closeOnEscape:!1}),S.pool[j][b]=h,h.closest(".ui-dialog").find(".ui-dialog-titlebar-close").remove()),k=W(b,c,f,g)):(k=!0,"alert"===b?a.alert(c):a.confirm(c)?e.isFunction(f)&&f():e.isFunction(g)&&g())),k},W=function(a,b,c,f){var g,h,i,j,k,l;return l=S.i18n._SYS.dialog[e.config("lang")],k=function(a,b){return d(this).dialog("close"),e.isFunction(a)&&a(),b},h=[],g={ok:l.ok,cancel:l.cancel,yes:l.yes,no:l.no},i=S.pool.systemDialog[a],j=d("[data-role='dialog-content']",i),0===j.size()&&(j=i),"confirm"===a?(h.push({text:g.ok,click:function(){return k.apply(this,[c,!0]),!0}}),h.push({text:g.cancel,click:function(){return k.apply(this,[f,!1]),!0}})):"confirmex"===a?(h.push({text:g.yes,click:function(){return k.apply(this,[c,!0]),!0}}),h.push({text:g.no,click:function(){return k.apply(this,[f,!1]),!0}}),h.push({text:g.cancel,click:function(){return k.apply(this,[null,!1]),!0}})):(a="alert",null!==c?h.push({text:g.ok,click:function(){return k.apply(this,[c,!0]),!0}}):h=null),j.html(b||""),i.dialog("option","buttons",h).dialog("open")},w=function(){var a,b,c,d,f,g;if(a=arguments,g=a[0],f=a[1],b=S.fn.handler,0===a.length)f=x(b);else if(e.isString(g))e.isFunction(f)?b[g]=f:f=b[g];else if(e.isPlainObject(g))for(d in g)c=g[d],e.isFunction(c)&&(b[d]=c);return f},O=function(b){var c,d,f,g;if(d=null,e.isArray(b))for(f=0,g=b.length;g>f;f++)c=b[f],(e.isFunction(c)||e.isFunction(c=S.fn.handler[c]))&&c.call(a);else e.isString(b)&&(c=S.fn.handler[b],e.isFunction(c)&&(d=c.apply(a,e.slice(arguments,1))));return d},I=function(a,b){return e.isFunction(a)?S.fn[b].push(a):void 0},x=function(a){var b;return b=null,e.isArray(a)||void 0!==a.length?b=[].concat([],e.slice(a)):e.isPlainObject(a)&&(b=d.extend(!0,{},a)),b},C=function(a){return S.fn.init[a]},A=function(a,b){var c,d;return c=a.split("."),d=null,(b||!E(c[0],H.key.storage))&&(d=S,e.each(c,function(a){var b;return b=e.hasProp(a,d),d=d[a],b})),d},Q=function(a,b){var c,d,f,g,h;return g=a.split("."),f=g.length,c=e.isPlainObject(b),1===f?(d=g[0],h=P(S,d,b,e.hasProp(d,S))):(h=S,e.each(g,function(a,c){return f-1>c?e.hasProp(a,h)||(h[a]={}):h[a]=P(h,a,b,e.isPlainObject(h[a])),h=h[a],!0})),h},P=function(a,b,c,f){return f&&e.isPlainObject(c)?d.extend(!0,a[b],c):a[b]=c,a[b]},D=function(a,b,c){return e.isObject(a)&&e.isString(b)&&e.hasProp(b,a)&&e.type(a[b])===c},E=function(a,b){return d.inArray(a,b)>-1},G=function(a){return H.key.storage.push(a)},S.modules.utils={handlers:[{name:"alert",handler:function(a,b){return V("alert",a,b)}},{name:"confirm",handler:function(a,b,c){return V("confirm",a,b,c)}},{name:"confirmEX",handler:function(a,b,c){return V("confirmEX",a,b,c)}},{name:"queue",handler:function(){return w.apply(a,this.slice(arguments))}},{name:"run",handler:function(){return O.apply(a,this.slice(arguments))}},{name:"url",handler:function(){var b,c;return b=a.location,c={search:b.search.substring(1),hash:b.hash.substring(1),query:{}},this.each(c.search.split("&"),function(a){return a=a.split("="),""!==e.trim(a[0])?c.query[a[0]]=a[1]:void 0}),c}},{name:"download",handler:function(b,c){var d,e,f;return a.ActiveXObject?a.ActiveXObject&&document.execCommand?(f=a.open(b,"_blank"),f.document.close(),f.document.execCommand("SaveAs",!0,c||b),f.close()):void 0:(e=document.createElement("a"),e.href=b,e.target="_blank",e.download=c||"unknown",d=document.createEvent("Event"),d.initEvent("click",!0,!0),e.dispatchEvent(d),(a.URL||a.webkitURL).revokeObjectURL(e.href))}},{name:"functionExists",handler:function(b,c){return D(c===!0?a:S.fn.handler,b,"function")}}]},K=function(a){return x(e.isPlainObject(a)?d.extend(S.config,a):S.config)},S.modules.flow={handlers:[{name:"sandbox",handler:function(a){var b;return b=K(a),O(S.fn.prepare),d(document).ready(function(){return O(S.fn.ready)}),S.sandboxStarted=!0,b||!1},value:!1,validator:function(){return S.sandboxStarted!==!0}},{name:"prepare",handler:function(a){return I(a,"prepare")}},{name:"ready",handler:function(a){return I(a,"ready")}}]},S.web_api={},S.config.api="",S.fn.init.apiNS=function(){},p=new c("I18n"),p.config({format_regexp:/\{%\s*([A-Z0-9_]+)\s*%\}/gi,value:function(a){return e.isString(a)?a:""}}),f=new c("Web_API"),f.config({format_regexp:/\:([a-z_]+)/g,value:function(a){var b;return null!=(b=v()+a)?b:""}}),M=new c("route"),M.config({format_regexp:/\:([a-z_]+)/g}),B=function(){var a,b,c;return a=arguments,b=a[0],c=a[1],e.isPlainObject(b)?e.each(b,B):e.isString(c)&&e.hasProp(c,S.fn.init)&&e.isFunction(b)?S.fn.init[c]=b:void 0},v=function(){var a;return a=e.config("api"),e.isString(a)&&""!==e.trim(a)?"/"+a:""},T=function(a,b,c){var d,g,h;switch(a){case"api":g=f,d=function(a){var b;return null!=(b=C("apiNS")(a))?b:a};break;case"route":g=M}return e.isPlainObject(b)?g.set(b):e.isString(b)&&(h=g.get(null!=d?d(b):b,c)),null!=h?h:null},u=function(a,b){return T("api",a,b)},N=function(a,b){return T("route",a,b)},S.modules.project={handlers:[{name:"config",handler:function(a){return this.isString(a)?S.config[a]:x(S.config)}},{name:"init",handler:function(){return B.apply(a,this.slice(arguments))}},{name:"i18n",handler:function(a,b){var c,d;return c=arguments,this.isPlainObject(a)?p.set(a):s.test(a)&&(2===c.length&&this.isString(b)&&!s.test(b)||(this.isPlainObject(b)?d=p.get(a,b):(d="",this.each(c,function(a){return e.isString(a)&&s.test(a)?d+=p.get(a):void 0})))),null!=d?d:null}},{name:"api",handler:u},{name:"route",handler:N}]},z=function(a){var b,c;return b={},c=a.match(/<[a-z]+[^>]*>/i),null!==c&&e.each(c[0].match(/(data(-[a-z]+)+=[^\s>]*)/gi)||[],function(a){return a=a.match(/data-(.*)="([^\s"]*)"/i),b[e.camelCase(a[1])]=a[2],!0}),b},y=function(a){var b;return b={},e.each(a,function(a){var c;return a.nodeType===g&&(c=a.nodeName.match(/^data-(.*)$/i))&&(b[e.camelCase(c(1))]=a.nodeValue),!0}),b},S.modules.storage={handlers:[{name:"data",handler:function(){var a,b,c,e,f,g;if(a=arguments,c=a.length,c>0){g=a[0];try{e=d(g).get(0)}catch(h){b=h,e=g}e&&e.nodeType===m?(f={},e.dataset?f=e.dataset:e.outerHTML?f=z(e.outerHTML):e.attributes&&d.isNumeric(e.attributes.length)&&(f=y(e.attributes))):this.isString(g)&&s.test(g)&&(f=1===c?A(g):Q(g,a[1]),c>1&&F(a)===!0&&G(g.split(".")[0]))}return null!=f?f:null}},{name:"save",handler:function(){var a,b,c,e;return a=arguments,b=a[0],e=a[1],U.storage&&this.isString(b)?(c=this.access(b),localStorage.setItem(b,escape(this.isPlainObject(c)?JSON.stringify(d.extend(c,e)):e))):void 0}},{name:"access",handler:function(){var a,b,c;if(b=arguments[0],U.storage&&(c=localStorage.getItem(b),null!==c)){c=unescape(c);try{c=JSON.parse(c)}catch(d){a=d,c=c}}return c||null},value:null,validator:function(a){return this.isString(a)}},{name:"clear",handler:function(){},expose:!1}]},J=function(a,b,c,f){var g;if(0!==arguments.length)return e.isPlainObject(a)===!1&&(a={url:a}),g=C("ajaxHandler")(b,c),e.isFunction(a.success)||(a.success=g.success),e.isFunction(a.error)||(a.error=g.error),d.ajax(d.extend(a,{async:f!==!0}))},S.modules.request={handlers:[{name:"ajax",handler:function(a,b,c){return J(a,b,c)}},{name:"sjax",handler:function(a,b,c){return J(a,b,c,!0)}}]},S.modules.HTML={handlers:[{name:"encodeEntities",handler:function(a){return this.isString(a)?a.replace(/([<>&\'\"])/,function(a,b){var c;switch(b){case"<":c=lt;break;case">":c=gt;break;case'"':c=quot;break;case"'":c=apos;break;case"&":c=amp}return"&"+c+";"}):a}},{name:"decodeEntities",handler:function(){},expose:!1}]},L=function(a){return"/"===a.charAt(0)?a:"/"+a},S.modules.URL={handlers:[{name:"pathname",handler:function(a){return L(this.isString(a)?a:location.pathname)}}]},e.extend(S.modules,e),e.api.formatList=function(a){return e.isPlainObject(a)?f.config({keys:a}):void 0},e.route.formatList=function(a){return e.isPlainObject(a)?M.config({keys:a}):void 0},e}(a,f),e.mask(b.name),e.__meta__=b,a[b.name]=e});
//# sourceMappingURL=tatami.min.map