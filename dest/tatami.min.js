/*!
 * Tatami v0.2.1
 * http://ourai.github.io/tatami/
 *
 * Copyright 2013, 2014 Ourairyu, http://ourai.ws/
 *
 * Date: 2014-06-25
 */

!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("Requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;l={name:"Tatami",version:"0.2.1"},i=1,c=2,p=3,d=4,k=5,j=6,n=7,e=8,g=9,h=10,f=11,m=12,o=/^[0-9A-Z_.]+[^_.]?$/i,b=jQuery,P={lang:document.documentElement.lang||document.documentElement.getAttribute("lang")||navigator.language||navigator.browserLanguage},Q=Ronin,Q.mask(l.name),Q.__meta__=l,M={storage:!!a.localStorage},C={key:{storage:["sandboxStarted","config","fn","buffer","pool","i18n","web_api"]}},L={sandboxStarted:!1,config:{debug:!0,platform:"",locale:P.lang,lang:P.lang.split("-")[0]},fn:{prepare:[],ready:[],init:{systemDialog:b.noop,ajaxHandler:function(a,c){return{success:function(d){var e;return e=Q.slice(arguments),d.code>0?Q.isFunction(a)?a.apply(b,e):void 0:Q.isFunction(c)?c.apply(b,e):N("alert",d.message)},error:b.noop}}},handler:{}},buffer:{},pool:{},i18n:{_SYS:{dialog:{zh:{title:"系统提示",close:"关闭",ok:"确定",cancel:"取消",yes:"是",no:"否"},en:{title:"System",close:"Close",ok:"Ok",cancel:"Cancel",yes:"Yes",no:"No"}}}}},A=function(a){return Q.slice(a,-1)[0]},K=function(){return b.ajaxSetup({type:"post",dataType:"json"}),b(document).ajaxError(function(a,b){var c;return c=b.responseText,!1})},N=function(c,d,e,f){var g,h,i,j;return j=!1,Q.isString(c)&&(c=c.toLowerCase(),Q.isFunction(b.fn.dialog)?(i="systemDialog",h=L.i18n._SYS.dialog[Q.config("lang")],Q.hasProp(i,L.pool)||(L.pool[i]={}),g=L.pool[i][c],g||(g=b('<div data-role="dialog" data-type="system" />').appendTo(b("body")).on({dialogcreate:x("systemDialog"),dialogopen:function(){return b(".ui-dialog-buttonset .ui-button",b(this).closest(".ui-dialog")).each(function(){var a;switch(a=b(this),Q.trim(a.text())){case h.ok:c="ok";break;case h.cancel:c="cancel";break;case h.yes:c="yes";break;case h.no:c="no"}return a.addClass("ui-button-"+c)})}}).dialog({title:h.title,width:400,minHeight:100,closeText:h.close,modal:!0,autoOpen:!1,resizable:!1,closeOnEscape:!1}),L.pool[i][c]=g,g.closest(".ui-dialog").find(".ui-dialog-titlebar-close").remove()),j=O(c,d,e,f)):(j=!0,"alert"===c?a.alert(d):a.confirm(d)?Q.isFunction(e)&&e():Q.isFunction(f)&&f())),j},O=function(a,c,d,e){var f,g,h,i,j,k;return k=L.i18n._SYS.dialog[Q.config("lang")],j=function(a,c){return b(this).dialog("close"),Q.isFunction(a)&&a(),c},g=[],f={ok:k.ok,cancel:k.cancel,yes:k.yes,no:k.no},h=L.pool.systemDialog[a],i=b("[data-role='dialog-content']",h),0===i.size()&&(i=h),"confirm"===a?(g.push({text:f.ok,click:function(){return j.apply(this,[d,!0]),!0}}),g.push({text:f.cancel,click:function(){return j.apply(this,[e,!1]),!0}})):"confirmex"===a?(g.push({text:f.yes,click:function(){return j.apply(this,[d,!0]),!0}}),g.push({text:f.no,click:function(){return j.apply(this,[e,!1]),!0}}),g.push({text:f.cancel,click:function(){return j.apply(this,[null,!1]),!0}})):(a="alert",null!==d?g.push({text:f.ok,click:function(){return j.apply(this,[d,!0]),!0}}):g=null),i.html(c||""),h.dialog("option","buttons",g).dialog("open")},r=function(){var a,b,c,d,e,f;if(a=arguments,f=a[0],e=a[1],b=L.fn.handler,0===a.length)e=s(b);else if(Q.isString(f))Q.isFunction(e)?b[f]=e:e=b[f];else if(Q.isPlainObject(f))for(d in f)c=f[d],Q.isFunction(c)&&(b[d]=c);return e},H=function(b){var c,d,e,f;if(d=null,Q.isArray(b))for(e=0,f=b.length;f>e;e++)c=b[e],(Q.isFunction(c)||Q.isFunction(c=L.fn.handler[c]))&&c.call(a);else Q.isString(b)&&(c=L.fn.handler[b],Q.isFunction(c)&&(d=c.apply(a,Q.slice(arguments,1))));return d},D=function(a,b){return Q.isFunction(a)?L.fn[b].push(a):void 0},s=function(a){var c;return c=null,Q.isArray(a)||void 0!==a.length?c=[].concat([],Q.slice(a)):Q.isPlainObject(a)&&(c=b.extend(!0,{},a)),c},x=function(a){return L.fn.init[a]},v=function(a,b){var c,d;return c=a.split("."),d=null,(b||!z(c[0],C.key.storage))&&(d=L,Q.each(c,function(a){var b;return b=Q.hasProp(a,d),d=d[a],b})),d},J=function(a,b){var c,d,e,f,g;return f=a.split("."),e=f.length,c=Q.isPlainObject(b),1===e?(d=f[0],g=I(L,d,b,Q.hasProp(d,L))):(g=L,Q.each(f,function(a,c){return e-1>c?Q.hasProp(a,g)||(g[a]={}):g[a]=I(g,a,b,Q.isPlainObject(g[a])),g=g[a],!0})),g},I=function(a,c,d,e){return e&&Q.isPlainObject(d)?b.extend(!0,a[c],d):a[c]=d,a[c]},y=function(a,b,c){return Q.isObject(a)&&Q.isString(b)&&Q.hasProp(b,a)&&Q.type(a[b])===c},z=function(a,c){return b.inArray(a,c)>-1},B=function(a){return C.key.storage.push(a)},Q.mixin({alert:function(a,b){return N("alert",a,b)},confirm:function(a,b,c){return N("confirm",a,b,c)},confirmEX:function(a,b,c){return N("confirmEX",a,b,c)},queue:function(){return r.apply(a,this.slice(arguments))},run:function(){return H.apply(a,this.slice(arguments))},url:function(){var b,c;return b=a.location,c={search:b.search.substring(1),hash:b.hash.substring(1),query:{}},this.each(c.search.split("&"),function(a){return a=a.split("="),""!==Q.trim(a[0])?c.query[a[0]]=a[1]:void 0}),c},download:function(b,c){var d,e,f;return a.ActiveXObject?a.ActiveXObject&&document.execCommand?(f=a.open(b,"_blank"),f.document.close(),f.document.execCommand("SaveAs",!0,c||b),f.close()):void 0:(e=document.createElement("a"),e.href=b,e.target="_blank",e.download=c||"unknown",d=document.createEvent("Event"),d.initEvent("click",!0,!0),e.dispatchEvent(d),(a.URL||a.webkitURL).revokeObjectURL(e.href))},functionExists:function(b,c){return y(c===!0?a:L.fn.handler,b,"function")}}),F=function(a){return s(Q.isPlainObject(a)?b.extend(L.config,a):L.config)},Q.mixin({sandbox:function(a){var c;return L.sandboxStarted!==!0&&(c=F(a),H(L.fn.prepare),b(document).ready(function(){return H(L.fn.ready)}),L.sandboxStarted=!0),c||!1},prepare:function(a){return D(a,"prepare")},ready:function(a){return D(a,"ready")}}),L.web_api={},L.config.api="",L.fn.init.apiNS=function(){},w=function(){var a,b,c;return a=arguments,b=a[0],c=a[1],Q.isPlainObject(b)?Q.each(b,w):Q.isString(c)&&Q.hasProp(c,L.fn.init)&&Q.isFunction(b)?L.fn.init[c]=b:void 0},q=function(){var a;return a=Q.config("api"),Q.isString(a)&&""!==Q.trim(a)?"/"+a:""},Q.mixin({config:function(a){return this.isString(a)?L.config[a]:s(L.config)},init:function(){return w.apply(a,this.slice(arguments))},i18n:function(){var a,c,d,e;return a=arguments,d=a[0],e=null,this.isPlainObject(d)?b.extend(L.i18n,d):o.test(d)&&(c=a[1],2===a.length&&this.isString(c)&&!o.test(c)||(this.isPlainObject(c)?(e=v("i18n."+d,!0),e=(this.isString(e)?e:"").replace(/\{%\s*([A-Z0-9_]+)\s*%\}/gi,function(a){return function(b,d){return a.hasProp(d,c)?c[d]:""}}(this))):(e="",this.each(a,function(a){var b;return Q.isString(a)&&o.test(a)?(b=v("i18n."+a,!0),e+=Q.isString(b)?b:""):void 0})))),e},api:function(){var a,c,d,e,f,g;return a=arguments,d=a[0],f=null,this.isPlainObject(d)?b.extend(L.web_api,d):this.isString(d)&&(c=a[1],e=x("apiNS")(d),f=q()+(null!=(g=v("web_api."+(null!=e?e:d),!0))?g:""),this.isPlainObject(c)&&(f=f.replace(/\:([a-z_]+)/g,function(a){return function(b,d){return a.hasProp(d,c)?c[d]:b}}(this)))),f}}),u=function(a){var b,c;return b={},c=a.match(/<[a-z]+[^>]*>/i),null!==c&&Q.each(c[0].match(/(data(-[a-z]+)+=[^\s>]*)/gi)||[],function(a){return a=a.match(/data-(.*)="([^\s"]*)"/i),b[Q.camelCase(a[1])]=a[2],!0}),b},t=function(a){var b;return b={},Q.each(a,function(a){var d;return a.nodeType===c&&(d=a.nodeName.match(/^data-(.*)$/i))&&(b[Q.camelCase(d(1))]=a.nodeValue),!0}),b},Q.mixin({data:function(){var a,c,d,e,f,g;if(a=arguments,d=a.length,d>0){g=a[0];try{e=b(g).get(0)}catch(h){c=h,e=g}e&&e.nodeType===i?(f={},e.dataset?f=e.dataset:e.outerHTML?f=u(e.outerHTML):e.attributes&&b.isNumeric(e.attributes.length)&&(f=t(e.attributes))):this.isString(g)&&o.test(g)&&(f=1===d?v(g):J(g,a[1]),d>1&&A(a)===!0&&B(g.split(".")[0]))}return null!=f?f:null},save:function(){var a,c,d,e;return a=arguments,c=a[0],e=a[1],M.storage&&this.isString(c)?(d=this.access(c),localStorage.setItem(c,escape(this.isPlainObject(d)?JSON.stringify(b.extend(d,e)):e))):void 0},access:function(){var a,b,c;if(b=arguments[0],this.isString(b)&&M.storage&&(c=localStorage.getItem(b),null!==c)){c=unescape(c);try{c=JSON.parse(c)}catch(d){a=d,c=c}}return c||null}}),E=function(a,c,d,e){var f;if(0!==arguments.length)return Q.isPlainObject(a)===!1&&(a={url:a}),f=x("ajaxHandler")(c,d),Q.isFunction(a.success)||(a.success=f.success),Q.isFunction(a.error)||(a.error=f.error),b.ajax(b.extend(a,{async:e!==!0}))},Q.mixin({ajax:function(a,b,c){return E(a,b,c)},sjax:function(a,b,c){return E(a,b,c,!0)}}),Q.mixin({encodeEntities:function(a){return this.isString(a)?a.replace(/([<>&\'\"])/,function(a,b){var c;switch(b){case"<":c=lt;break;case">":c=gt;break;case'"':c=quot;break;case"'":c=apos;break;case"&":c=amp}return"&"+c+";"}):a},decodeEntities:function(){}}),G=function(a){return"/"===a.charAt(0)?a:"/"+a},Q.mixin({pathname:function(a){return G(this.isString(a)?a:location.pathname)}}),a[l.name]=Q});
//# sourceMappingURL=tatami.min.map